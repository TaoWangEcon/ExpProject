{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}/Users/Myworld/Dropbox/ExpProject/workingfolder/pop_log.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res}20 Jun 2019, 22:56:34
{txt}
{com}. 
. ****************************************
. **** Population Moments Analysis ******
. ****************************************
. 
. ***********************
. **   Merge other data**
. ***********************
. 
. use "${c -(}folder{c )-}/NYFEDSurvey/InfExpSCEProbPopM",clear 
{txt}
{com}. 
. merge 1:1 year month using "${c -(}mainfolder{c )-}/OtherData/RecessionDateM.dta", keep(match)
{res}{txt}{p 0 7 2}
(note: variable
year was 
int, now float to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}               0
{txt}{col 5}matched{col 30}{res}              53{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge  recession_merge
{res}{txt}
{com}. 
. merge 1:1 year month using "${c -(}mainfolder{c )-}/OtherData/InfM.dta",keep(match using master)
{res}{txt}(label _merge already defined)

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             802
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}             802{txt}  (_merge==2)

{col 5}matched{col 30}{res}              53{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge inflation_merge 
{res}{txt}
{com}. 
. merge 1:1 year month using "${c -(}folder{c )-}/MichiganSurvey/InfExpMichM.dta"
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             151
{txt}{col 9}from master{col 30}{res}             151{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}             704{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename inf_exp InfExpMichMed 
{res}{txt}
{com}. rename _merge michigan_merge 
{res}{txt}
{com}. 
. ***********************************************
. ** create quarter variable to match with spf
. *********************************************
. 
. gen quarter = .
{txt}(855 missing values generated)

{com}. replace quarter=1 if month<4 & month >=1
{txt}(216 real changes made)

{com}. replace quarter=2 if month<7 & month >=4
{txt}(213 real changes made)

{com}. replace quarter=3 if month<10 & month >=7
{txt}(213 real changes made)

{com}. replace quarter=4 if month<=12 & month >=10
{txt}(213 real changes made)

{com}. 
. merge m:1 year quarter using "${c -(}folder{c )-}/SPF/individual/InfExpSPFPointPopQ.dta",keep(match using master)
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             250
{txt}{col 9}from master{col 30}{res}             249{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}matched{col 30}{res}             606{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge spf_merge 
{res}{txt}
{com}. 
. 
. merge m:1 year quarter using "${c -(}folder{c )-}/SPF/InfExpSPFDstPopQ.dta",keep(match using master)
{res}{txt}{p 0 7 2}
(note: variable
year was 
float, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
quarter was 
float, now double to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             708
{txt}{col 9}from master{col 30}{res}             708{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}             148{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge spf_dst_merge 
{res}{txt}
{com}. 
. 
. *************************
. ** Declare time series **
. **************************
. 
. gen date2=string(year)+"m"+string(month)
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}(1 missing value generated)

{com}. format date3 %tm 
{txt}
{com}. 
. drop date2 date 
{txt}
{com}. rename date3 date
{res}{txt}
{com}. 
. tsset date
{res}{txt}{col 9}time variable:  {res}{col 25}date, 1948m1 to 2019m3
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. sort year quarter month 
{txt}
{com}. 
. 
. ******************************
. *** Computing some measures **
. ******************************
. 
. gen SCE_FE = Q9_mean - Inf1yf_CPICore
{txt}(805 missing values generated)

{com}. label var SCE_FE "1-yr-ahead forecast error"
{txt}
{com}. 
. gen SPFCPI_FE = CPI1y - Inf1yf_CPIAU
{txt}(415 missing values generated)

{com}. label var SPFCPI_FE "1-yr-ahead forecast error(SPF CPI)"
{txt}
{com}. gen SPFCCPI_FE = CORECPI1y - Inf1yf_CPICore
{txt}(721 missing values generated)

{com}. label var SPFCPI_FE "1-yr-ahead forecast error(SPF Core CPI)"
{txt}
{com}. gen SPFPCE_FE = PCE1y - Inf1yf_PCE
{txt}(721 missing values generated)

{com}. label var SPFPCE_FE "1-yr-ahead forecast error(SPF PCE)"
{txt}
{com}. 
. 
. 
. 
. *****************************
. ****    Summary Charts ******
. *****************************
. 
. 
. /*
> **************************
> ** Single series charts **
> **************************
> 
> foreach var in Q9_mean Q9_var Q9_iqr Q9_cent50 Q9_disg ///
>                CPI1y PCE1y CORECPI1y COREPCE1y ///
>                            CPI_disg PCE_disg CORECPI_disg COREPCE_disg ///
>                            CPI_ct50 PCE_ct50 CORECPI_ct50 COREPCE_ct50{c -(}
> local var_lb: var label `var'
> tsline `var' if `var'!=.,title("`var_lb'") xtitle("Time") ytitle("")
> graph export "${c -(}sum_graph_folder{c )-}/`var'", as(png) replace 
> {c )-}
> 
> 
> 
> ***************************
> ** Multiple series charts**
> ***************************
> 
> drop if CPI1y ==. | PCE1y==.
> 
> twoway (tsline Q9_mean)  (tsline Q9_cent50,lp("dash")) ///
>                          (tsline InfExpMichMed, lp("dot-dash")) ///
>                                                  (tsline CPI1y, lp("shortdash")), ///
>                                                  title("1-yr-ahead Expected Inflation") ///
>                                                  xtitle("Time") ytitle("") ///
>                                                  legend(label(1 "Mean Expectation(SCE)") label(2 "Median Expectation(SCE)") ///
>                                                         label(3 "Median Expectation(Michigan)") label(4 "Mean Expectation(SPF)"))
> graph export "${c -(}sum_graph_folder{c )-}/mean_med", as(png) replace
> 
> twoway (tsline Q9_mean, ytitle(" ",axis(1))) ///
>        (tsline Q9_var,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_mean!=., ///
>            title("1-yr-ahead Expected Inflation (SCE)") xtitle("Time") ///
>            legend(label(1 "Average Expectation") label(2 "Average Uncertainty(RHS)"))
> graph export "${c -(}sum_graph_folder{c )-}/mean_var", as(png) replace 
> 
> 
> 
> twoway (tsline Q9_mean, ytitle(" ",axis(1))) ///
>        (tsline Q9_disg,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_mean!=., ///
>            title("1-yr-ahead Expected Inflation") xtitle("Time") ///
>            legend(label(1 "Average Expectation") label(2 "Disagreements(RHS)"))
> graph export "${c -(}sum_graph_folder{c )-}/mean_disg", as(png) replace 
> 
> 
> twoway (tsline Q9_disg, ytitle(" ",axis(1))) ///
>        (tsline CORECPI_disg,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if CORECPI_disg!=., ///
>            title("Disagreements in 1-yr-ahead Inflation") xtitle("Time") ///
>            legend(label(1 "Disagreements (SCE)") label(2 "Disagreements(SPF)(RHS)"))
> graph export "${c -(}sum_graph_folder{c )-}/disg_disg", as(png) replace 
> 
> 
> twoway (tsline Q9_var, ytitle(" ",axis(1))) ///
>        (tsline PRCCPIVar1mean, yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_var!=., ///
>            title("Uncertainty in 1-yr-ahead Inflation") xtitle("Time") ///
>            legend(label(1 "Uncertainty (SCE)")  /// 
>                   label(2 "Uncertainty (SPF CPI)(RHS)")) 
>                           
> graph export "${c -(}sum_graph_folder{c )-}/var_var", as(png) replace 
> 
> 
> twoway (tsline Q9_disg, ytitle(" ",axis(1))) ///
>        (tsline Q9_var,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_disg!=., ///
>            title("1-yr-ahead Expected Inflation") xtitle("Time") ///
>            legend(label(1 "Disagreements") label(2 "Average Uncertainty(RHS)")) 
> graph export "${c -(}sum_graph_folder{c )-}/var_disg", as(png) replace 
> 
> 
> 
> twoway (tsline CORECPI_disg, ytitle(" ",axis(1))) ///
>        (tsline PRCCPIVar1mean,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_disg!=., ///
>            title("1-yr-ahead Expected Inflation(SPF)") xtitle("Time") ///
>            legend(label(1 "Disagreements") label(2 "Average Uncertainty(RHS)")) 
> graph export "${c -(}sum_graph_folder{c )-}/var_disg2", as(png) replace 
> 
> 
> twoway (tsline Q9_mean) (tsline CORECPI1y,lp("longdash")) ///
>        (tsline Inf1yf_PCEPI,lp("dash")) ///
>        (tsline Inf1yf_CPIAU,lp("shortdash")) ///
>            (tsline Inf1yf_CPICore,lp("dash_dot")) ///
>            if Q9_mean!=., ///
>            title("1-yr-ahead Expected Inflation") xtitle("Time") ytitle("") ///
>            legend(label(1 "Mean Forecast(SCE)") label(2 "Mean Forecast(SPF)") label(3 "Realized Inflation(PCE)") ///
>                   label(4 "Realized Inflation(Headline CPI)") label(5 "Realized Inflation(Core CPI)"))
> graph export "${c -(}sum_graph_folder{c )-}/mean_true", as(png) replace
> 
> 
> twoway (tsline Q9_mean)  (tsline Inf1y_PCEPI,lp("dash")) ///
>        (tsline Inf1y_CPIAU,lp("shortdash")) ///
>            (tsline Inf1y_CPICore,lp("dash_dot")) ///
>            if Q9_mean!=., ///
>            title("1-yr-ahead Expected Inflation") xtitle("Time") ytitle("") ///
>            legend(label(1 "Mean Expectation") label(2 "Past Inflation(PCE)") ///
>                   label(3 "Past Inflation(Headline CPI)") label(4 "Past Inflation(Core CPI)"))
> graph export "${c -(}sum_graph_folder{c )-}/mean_past", as(png) replace
> 
> 
> twoway (tsline SCE_FE,ytitle("",axis(1)))  (tsline SPFCPI_FE, yaxis(2) lp("dash")) ///
>        (tsline SPFPCE_FE, yaxis(2) lp("dash_dot"))  ///  
>                          if SPFPCE_FE!=., ///
>                                                  title("1-yr-ahead Forecast Errors") ///
>                                                  xtitle("Time") ytitle("") ///
>                                                  legend(label(1 "SCE") label(2 "SPF CPI(RHS)") ///
>                                                  label(3 "SPF PCE(RHS)"))
> graph export "${c -(}sum_graph_folder{c )-}/fe_fe", as(png) replace
> 
> 
> twoway (tsline PRCCPIVar1p25, ytitle(" ",axis(1)) lp("dash")) ///
>        (tsline PRCCPIVar1p75, ytitle(" ",axis(1)) lp("dash")) ///
>            (tsline PRCCPIVar1p50, ytitle(" ",axis(1)) lp("solid") ) ///
>            if PRCCPIVar1p25!=. , /// 
>            title("1-yr-ahead Expected Inflation(SPF CPI)") xtitle("Time") ///
>            legend(label(1 "25 percentile of uncertainty") label(2 "75 percentile of uncertainty") ///
>                   label(3 "50 percentile of uncertainty")) 
> graph export "${c -(}sum_graph_folder{c )-}/IQRvarCPI", as(png) replace 
> 
> 
> twoway (tsline PRCPCEVar1p25, ytitle(" ",axis(1)) lp("dash")) ///
>        (tsline PRCPCEVar1p75, ytitle(" ",axis(1)) lp("dash")) ///
>            (tsline PRCPCEVar1p50, ytitle(" ",axis(1)) lp("solid") ) ///
>            if PRCPCEVar1p25!=. , ///
>            title("1-yr-ahead Expected Inflation(SPF PCE)") xtitle("Time") ///
>            legend(label(1 "25 percentile of uncertainty") label(2 "75 percentile of uncertainty") ///
>                   label(3 "50 percentile of uncertainty")) 
> graph export "${c -(}sum_graph_folder{c )-}/IQRvarPCE", as(png) replace 
> */
. 
. 
. twoway (tsline SCE_FE, ytitle(" ",axis(1))) ///
>        (tsline Q9_var,yaxis(2) ytitle("",axis(2)) lp("dash")) ///
>            if Q9_var!=., ///
>            title("1-yr-ahead Expected Inflation") xtitle("Time") ///
>            legend(label(1 "Average Forecast Error") label(2 "Average Uncertainty(RHS)")) 
{res}{txt}
{com}. graph export "${c -(}sum_graph_folder{c )-}/fe_disg", as(png) replace 
{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/fe_disg written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. clear

. clear

. help histogram

. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Histograms of Moments  ****
. ******************************
. 
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.     histogram `var'`mom'`i', by(year) title("Histogram of `var'`mom'`i'")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'`i'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}.  {c )-}
{txt}  8{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Histograms of Moments  ****
. ******************************
. 
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.         local lb: variable label `var'`mom'`i'
{txt}  5{com}.     histogram `var'`mom'`i', by(year,title("Distribution of lb")) 
{txt}  6{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'`i'_hist", as(png) replace 
{txt}  7{com}.  {c )-}
{txt}  8{com}.  {c )-}
{txt}  9{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean0_hist written in PNG format)
{err}invalid syntax
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Histograms of Moments  ****
. ******************************
. 
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.         local lb: variable label `var'`mom'`i'
{txt}  5{com}.     histogram `var'`mom'`i', by(year,title("Distribution of `lb'")) 
{txt}  6{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'`i'_hist", as(png) replace 
{txt}  7{com}.  {c )-}
{txt}  8{com}.  {c )-}
{txt}  9{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. help histogram

. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Mean Forecast of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Mean Forecast of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.         local lb: variable label `var'`mom'`i'
{txt}  5{com}.     histogram `var'`mom'`i', by(year,title("Distribution of `lb'")) bin(10) 
{txt}  6{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'`i'_hist", as(png) replace 
{txt}  7{com}.  {c )-}
{txt}  8{com}.  {c )-}
{txt}  9{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar0_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0) bin(10)) ///
>                (histogram `var'`mom'1) bin(10)), by(year,title("Distribution of `lb'")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}parentheses do not balance
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0) bin(10)) ///
>                (histogram `var'`mom'1) bin(10)), by(year,title("Distribution of `lb'"))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}bin(10) is not a twoway plot type
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0) ///
>                (histogram `var'`mom'1), by(year,title("Distribution of `lb'")) bin(10)
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}option {bf:bin()} not allowed
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10)) ///
>                (histogram `var'`mom'1,bin(10)), by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10),color(red)) ///
>                (histogram `var'`mom'1,bin(10),fcolor(none) lcolor(black)), by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}factor variables and time-series operators not allowed
{txt}{search r(101):r(101);}

end of do-file

{search r(101):r(101);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10),color(red)) ///
>                (histogram `var'`mom'1,bin(10)), by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}factor variables and time-series operators not allowed
{txt}{search r(101):r(101);}

end of do-file

{search r(101):r(101);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(black)), by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(black)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

end of do-file

{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "Uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "Uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10) color(blue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10) color(blue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

end of do-file

{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10) color(blue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(30) color(blue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. help color

. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom'0,kernel(gaussian) color(ltblue)) ///
>                (kdensity `var'`mom'1,kernel(gaussian) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom'0,kernel(gaussian)) ///
>                (kdensity `var'`mom'1,kernel(gaussian)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom'0) ///
>                (kdensity `var'`mom'1), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD16963.000000"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom'0) ///
>                (kdensity `var'`mom'1,fcolor(ltblue)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. clear

. help kdensity

. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom', n(30)) ///
>                (kdensity `var'`mom'1, n(30) fcolor(ltblue)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}PRCCPIVar ambiguous abbreviation
{txt}{search r(111):r(111);}

end of do-file

{search r(111):r(111);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(30) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(30) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity  `var'`mom'0, n(30)) ///
>                (kdensity `var'`mom'1, n(30) fcolor(ltblue)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. 
. ** These are moments of moments 
. local MomentsMom PRCCPIMean0p25 PRCCPIMean1p25 PRCPCEMean0p25 PRCPCEMean1p25 /// 
>               PRCCPIVar0p25 PRCCPIVar1p25 PRCPCEVar0p25 PRCPCEVar1p25 ///
>                           PRCCPIMean0p50 PRCCPIMean1p50 PRCPCEMean0p50 PRCPCEMean1p50 /// 
>               PRCCPIVar0p50 PRCCPIVar1p50 PRCPCEVar0p50 PRCPCEVar1p50 ///
>                           PRCCPIMean0p75 PRCCPIMean1p75 PRCPCEMean0p75 PRCPCEMean1p75 /// 
>               PRCCPIVar0p75 PRCCPIVar1p75 PRCPCEVar0p75 PRCPCEVar1p75 ///
> 
{txt}
{com}. 
. ** quarterly population data 
. preserve 
{txt}
{com}. collapse (mean) `Moments' `MomentsMom', by(date year quarter) 
{txt}
{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. rename `var' `var'mean
{txt}  3{com}. label var `var'mean "Population moments: mean of `var'"
{txt}  4{com}. {c )-}
{res}{txt}
{com}. save "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1",replace 
{txt}(note: file /Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/InfExpSPFDstPopQ1.dta not found)
file /Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/InfExpSPFDstPopQ1.dta saved

{com}. restore 
{txt}
{com}. 
. collapse (sd) `Moments', by(date year quarter) 
{txt}
{com}. foreach var in `Moments'{c -(}
{txt}  2{com}. replace `var' = `var'^2
{txt}  3{com}. rename `var' `var'disg
{txt}  4{com}. label var `var'disg "Population moments: variance of `var'"
{txt}  5{com}. {c )-}
{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}(49 real changes made)
{res}{txt}
{com}. merge using "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1"
{txt}{p}
(note: you are using old
{bf:merge} syntax; see
{bf:{help merge:[D] merge}} for new syntax)
{p_end}

{com}. drop _merge
{txt}
{com}. 
. drop date 
{txt}
{com}.  
. save "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ",replace 
{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/InfExpSPFDstPopQ.dta saved

{com}. 
. rm "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1.dta"
{txt}
{com}. 
. 
{txt}end of do-file

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean_hist written in PNG format)

{com}. 
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (histogram `var'`mom'0,bin(20) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(20) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}option {bf:bin()} not allowed
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,color(ltblue)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,lcolor(red)), ///
>                by(year,title("Distribution of `lb'"))  ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{err}as(png) is not a twoway plot type
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 /// 
>     twoway (kdensity `var'`mom'1,lcolor(red)), ///
>                by(year,title("Distribution of `lb'"))  ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  4{com}.  {c )-}
{txt}  5{com}. {c )-}
{err}twoway not allowed
{txt}{search r(101):r(101);}

end of do-file

{search r(101):r(101);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 /// 
>     kdensity `var'`mom'1,lcolor(red), ///
>                by(year,title("Distribution of `lb'"))  ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  4{com}.  {c )-}
{txt}  5{com}. {c )-}
{err}kdensity not allowed
{txt}{search r(101):r(101);}

end of do-file

{search r(101):r(101);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 /// 
>     twoway (kdensity `var'`mom'1,lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  4{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{err}twoway not allowed
{txt}{search r(101):r(101);}

end of do-file

{search r(101):r(101);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 
{txt}  4{com}.     twoway (kdensity `var'`mom'1,lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 
{txt}  4{com}.     twoway (kdensity `var'`mom'1,lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ytitle("Fraction of population")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. help kdensity

. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0 
{txt}  4{com}.     twoway (kdensity `var'`mom'1, n(50) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ytitle("Fraction of population")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(10) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(10) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> 
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (histogram `var'`mom'0,bin(20) color(ltblue)) ///
>                (histogram `var'`mom'1,bin(20) fcolor(none) lcolor(red)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> 
> /*
> foreach mom in Var{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'0
>     twoway (kdensity  `var'`mom'0, n(30)) ///
>                (kdensity `var'`mom'1, n(30) fcolor(ltblue)), by(year,title("Distribution of `lb'")) ///
>                    legend(order(1 "Nowcasting" 2 "Forecasting" ))
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
> ** These are moments of moments 
> local MomentsMom PRCCPIMean0p25 PRCCPIMean1p25 PRCPCEMean0p25 PRCPCEMean1p25 /// 
>               PRCCPIVar0p25 PRCCPIVar1p25 PRCPCEVar0p25 PRCPCEVar1p25 ///
>                           PRCCPIMean0p50 PRCCPIMean1p50 PRCPCEMean0p50 PRCPCEMean1p50 /// 
>               PRCCPIVar0p50 PRCCPIVar1p50 PRCPCEVar0p50 PRCPCEVar1p50 ///
>                           PRCCPIMean0p75 PRCCPIMean1p75 PRCPCEMean0p75 PRCPCEMean1p75 /// 
>               PRCCPIVar0p75 PRCCPIVar1p75 PRCPCEVar0p75 PRCPCEVar1p75 ///
> 
> 
> ** quarterly population data 
> preserve 
> collapse (mean) `Moments' `MomentsMom', by(date year quarter) 
> 
> foreach var in `Moments'{c -(}
> rename `var' `var'mean
> label var `var'mean "Population moments: mean of `var'"
> {c )-}
> save "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1",replace 
> restore 
> 
> collapse (sd) `Moments', by(date year quarter) 
> foreach var in `Moments'{c -(}
> replace `var' = `var'^2
> rename `var' `var'disg
> label var `var'disg "Population moments: variance of `var'"
> {c )-}
> merge using "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1"
> drop _merge
> 
> drop date 
>  
> save "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ",replace 
> 
> rm "${c -(}mainfolder{c )-}/SurveyData/SPF/InfExpSPFDstPopQ1.dta"
> 

{txt}end of do-file

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ///
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{err}as(png) is not a twoway plot type
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                (hist `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}fcolor(none) is not a twoway plot type
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                (hist `var'`mom'1), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}) required
{txt}{search r(100):r(100);}

end of do-file

{search r(100):r(100);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'0
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                (histogram `var'`mom'1), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{err}) required
{txt}{search r(100):r(100);}

end of do-file

{search r(100):r(100);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'1
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)) ///
>                (histogram `var'`mom'1), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "expected inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty of inflation from y-1 to y"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of inflation from y to y+1"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'1
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)

{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from previous year"
{txt}  4{com}.         label var `var'`mom'1 "1-year-head expected inflation"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty about inflation from previous year"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of 1-year-head expected inflation"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. 
. foreach mom in Mean{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'1
{txt}  4{com}.     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIMean1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEMean1_hist written in PNG format)

{com}. 
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'1 
{txt}  4{com}.     twoway (kdensity `var'`mom'1, n(50) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) ytitle("Fraction of population")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/ExpProject/workingfolder/DoFile/Step02d_CleaningSPF&SumStat_IndDst.do"
{txt}
{com}. *******************************************************************************
. ** This do file cleans the density/moment estimats of individual SPF 
. ** InfExpSPFDstIndQ.dta. 
. ** And then it generates the population moments from SPF. InfExpSPFDstPopQ.dta.
. ** This data is quarterly. So one may need to convert SCE to quarterly for a 
. ** comparison of the two. 
. ********************************************************************************* 
. 
. clear 
{txt}
{com}. set more off 
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/ExpProject/workingfolder"
{txt}
{com}. global datafolder "${c -(}mainfolder{c )-}/SurveyData/SPF/individual"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/tables"
{txt}
{com}. 
. cd ${c -(}datafolder{c )-}
{res}/Users/Myworld/Dropbox/ExpProject/workingfolder/SurveyData/SPF/individual
{txt}
{com}. 
. use InfExpSPFDstIndQ,clear
{txt}
{com}. 
. 
. local Moments PRCCPIMean0 PRCCPIMean1 PRCPCEMean0 PRCPCEMean1 /// 
>               PRCCPIVar0 PRCCPIVar1 PRCPCEVar0 PRCPCEVar1
{txt}
{com}. 
. *****************************
. **   Summary Stats of SPF  **
. *****************************
.                           
.           
. * table 1
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save 

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1628      1606      1518      1453      1628      1606      1518      1453
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-26472.67 -18576.11 -14787.64 -4144.223 -574.5461 -423879.7 -77.18375 -1351.355
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3557954 -.3144251  .0007294  .0008905  .0008926  .0009548
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4318608  .4180752  .4155341  .4188922  .0073694  .0066313  .0058931  .0104073
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4885004  .4883978  .4829901  .4807022  .0174449  .0218019  .0189756  .0221884
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5241744  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8643356  .6652987  .8650593  .6942495  .0446446  .0464889  .0424704  .0458355
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res}        2         2  1.908029  1.993781  .0771097  .0961309  .0771097  .0961309
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res}  2.68019  2.555522       2.5  2.452254  .8783811  1.571215  .8783811    1.1326
{txt}{ralign 8:max} {...}
{c |}{...}
 {res} 8.763064  18618.39  996.2262  3.331012  967.4245   3367980  1.14e+07  111391.2
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-26472.67}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .4318608}}}{space 1}{space 1}{ralign 9:{res:{sf: .4885004}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8643356}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-18576.11}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .4180752}}}{space 1}{space 1}{ralign 9:{res:{sf: .4883978}}}{space 1}{space 1}{ralign 9:{res:{sf: .5241744}}}{space 1}{space 1}{ralign 9:{res:{sf: .6652987}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-14787.64}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3557954}}}{space 1}{space 1}{ralign 9:{res:{sf: .4155341}}}{space 1}{space 1}{ralign 9:{res:{sf: .4829901}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8650593}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-4144.223}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .4188922}}}{space 1}{space 1}{ralign 9:{res:{sf: .4807022}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6942495}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1628}}}{space 1}{space 1}{ralign 9:{res:{sf:-574.5461}}}{space 1}{space 1}{ralign 9:{res:{sf: .0007294}}}{space 1}{space 1}{ralign 9:{res:{sf: .0073694}}}{space 1}{space 1}{ralign 9:{res:{sf: .0174449}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0446446}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1606}}}{space 1}{space 1}{ralign 9:{res:{sf:-423879.7}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0066313}}}{space 1}{space 1}{ralign 9:{res:{sf: .0218019}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0464889}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1518}}}{space 1}{space 1}{ralign 9:{res:{sf:-77.18375}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0058931}}}{space 1}{space 1}{ralign 9:{res:{sf: .0189756}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0424704}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1453}}}{space 1}{space 1}{ralign 9:{res:{sf:-1351.355}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0104073}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221884}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458355}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}{space 1}{ralign 9:{res:{sf: 8.763064}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555522}}}{space 1}{space 1}{ralign 9:{res:{sf: 18618.39}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.908029}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 996.2262}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.993781}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}{space 1}{ralign 9:{res:{sf: 3.331012}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 967.4245}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}{space 1}{ralign 9:{res:{sf:  3367980}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .8783811}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.14e+07}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0961309}}}{space 1}{space 1}{ralign 9:{res:{sf:   1.1326}}}{space 1}{space 1}{ralign 9:{res:{sf: 111391.2}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify  
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("rawdata") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}. 
.       egen `var'p1=pctile(`var'),p(1)
{txt}  3{com}.           egen `var'p99=pctile(`var'),p(99)
{txt}  4{com}.           replace `var' = . if `var' <`var'p1 | (`var' >`var'p99 & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(31 real changes made, 31 to missing)
(33 real changes made, 33 to missing)
(30 real changes made, 30 to missing)
(28 real changes made, 28 to missing)
(34 real changes made, 34 to missing)
(31 real changes made, 31 to missing)
(29 real changes made, 29 to missing)
(29 real changes made, 29 to missing)

{com}. 
. * table 2
. tabstat `Moments', st(N min p1 p10 p25 p50 p75 p90 p99 max) save

{txt}   stats {...}
{c |}{...}
  PRCCP~n0  PRCCP~n1  PRCPC~n0  PRCPC~n1  PRCCP~r0  PRCCP~r1  PRCPC~r0  PRCPC~r1
{hline 9}{c +}{hline 80}
{ralign 8:N} {...}
{c |}{...}
 {res}     1597      1573      1488      1425      1594      1575      1489      1424
{txt}{ralign 8:min} {...}
{c |}{...}
 {res}-.4027533 -.3517563 -.3550673 -.3144251   .000781  .0008905  .0008926  .0009548
{txt}{ralign 8:p1} {...}
{c |}{...}
 {res} .1839519  .1162736  .1811113  .2044044  .0011571  .0009679  .0010615  .0010894
{txt}{ralign 8:p10} {...}
{c |}{...}
 {res} .4360281  .4270399  .4255956  .4270399  .0095803  .0088585  .0072885  .0130076
{txt}{ralign 8:p25} {...}
{c |}{...}
 {res} .4900766  .4892362  .4832073  .4832572  .0180595  .0221731    .01937  .0222012
{txt}{ralign 8:p50} {...}
{c |}{...}
 {res} .5203517  .5240564  .5199678  .5206167  .0291921  .0333747  .0291921  .0333747
{txt}{ralign 8:p75} {...}
{c |}{...}
 {res} .8582156  .6422359  .8628509  .6701552  .0438226  .0462024  .0416667  .0458334
{txt}{ralign 8:p90} {...}
{c |}{...}
 {res} 1.998511         2  1.865619  1.947242  .0771097  .0771097  .0661502   .092026
{txt}{ralign 8:p99} {...}
{c |}{...}
 {res} 2.552758       2.5  2.303137  2.259464  .6345832  1.239815  .4814685  .9142628
{txt}{ralign 8:max} {...}
{c |}{...}
 {res}  2.68019  2.555054       2.5  2.452254  .8514586  1.571215  .7210329  1.093869
{txt}{hline 9}{c BT}{hline 80}

{com}. 
. return list

{txt}matrices:
          r(StatTotal) : {res} 10 x 8
{txt}
{com}. mat T = r(StatTotal)'
{txt}
{com}. matlist T
{res}
{txt}{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:N}{space 1}{space 1}{ralign 9:min}{space 1}{space 1}{ralign 9:p1}{space 1}{space 1}{ralign 9:p10}{space 1}{space 1}{ralign 9:p25}{space 1}{space 1}{ralign 9:p50}{space 1}{space 1}{ralign 9:p75}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1597}}}{space 1}{space 1}{ralign 9:{res:{sf:-.4027533}}}{space 1}{space 1}{ralign 9:{res:{sf: .1839519}}}{space 1}{space 1}{ralign 9:{res:{sf: .4360281}}}{space 1}{space 1}{ralign 9:{res:{sf: .4900766}}}{space 1}{space 1}{ralign 9:{res:{sf: .5203517}}}{space 1}{space 1}{ralign 9:{res:{sf: .8582156}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1573}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3517563}}}{space 1}{space 1}{ralign 9:{res:{sf: .1162736}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4892362}}}{space 1}{space 1}{ralign 9:{res:{sf: .5240564}}}{space 1}{space 1}{ralign 9:{res:{sf: .6422359}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1488}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3550673}}}{space 1}{space 1}{ralign 9:{res:{sf: .1811113}}}{space 1}{space 1}{ralign 9:{res:{sf: .4255956}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832073}}}{space 1}{space 1}{ralign 9:{res:{sf: .5199678}}}{space 1}{space 1}{ralign 9:{res:{sf: .8628509}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1425}}}{space 1}{space 1}{ralign 9:{res:{sf:-.3144251}}}{space 1}{space 1}{ralign 9:{res:{sf: .2044044}}}{space 1}{space 1}{ralign 9:{res:{sf: .4270399}}}{space 1}{space 1}{ralign 9:{res:{sf: .4832572}}}{space 1}{space 1}{ralign 9:{res:{sf: .5206167}}}{space 1}{space 1}{ralign 9:{res:{sf: .6701552}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1594}}}{space 1}{space 1}{ralign 9:{res:{sf:  .000781}}}{space 1}{space 1}{ralign 9:{res:{sf: .0011571}}}{space 1}{space 1}{ralign 9:{res:{sf: .0095803}}}{space 1}{space 1}{ralign 9:{res:{sf: .0180595}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0438226}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1575}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008905}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009679}}}{space 1}{space 1}{ralign 9:{res:{sf: .0088585}}}{space 1}{space 1}{ralign 9:{res:{sf: .0221731}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0462024}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1489}}}{space 1}{space 1}{ralign 9:{res:{sf: .0008926}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010615}}}{space 1}{space 1}{ralign 9:{res:{sf: .0072885}}}{space 1}{space 1}{ralign 9:{res:{sf:   .01937}}}{space 1}{space 1}{ralign 9:{res:{sf: .0291921}}}{space 1}{space 1}{ralign 9:{res:{sf: .0416667}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:     1424}}}{space 1}{space 1}{ralign 9:{res:{sf: .0009548}}}{space 1}{space 1}{ralign 9:{res:{sf: .0010894}}}{space 1}{space 1}{ralign 9:{res:{sf: .0130076}}}{space 1}{space 1}{ralign 9:{res:{sf: .0222012}}}{space 1}{space 1}{ralign 9:{res:{sf: .0333747}}}{space 1}{space 1}{ralign 9:{res:{sf: .0458334}}}{space 1}

{space 0}{space 0}{ralign 12:}{space 1}{c |}{space 1}{ralign 9:p90}{space 1}{space 1}{ralign 9:p99}{space 1}{space 1}{ralign 9:max}{space 1}
{space 0}{hline 13}{c   +}{hline 11}{hline 11}{hline 11}
{space 0}{space 0}{ralign 12:PRCCPIMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.998511}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.552758}}}{space 1}{space 1}{ralign 9:{res:{sf:  2.68019}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:        2}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.555054}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.865619}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.303137}}}{space 1}{space 1}{ralign 9:{res:{sf:      2.5}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEMean1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: 1.947242}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.259464}}}{space 1}{space 1}{ralign 9:{res:{sf: 2.452254}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: .6345832}}}{space 1}{space 1}{ralign 9:{res:{sf: .8514586}}}{space 1}
{space 0}{space 0}{ralign 12:PRCCPIVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0771097}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.239815}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.571215}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar0}{space 1}{c |}{space 1}{ralign 9:{res:{sf: .0661502}}}{space 1}{space 1}{ralign 9:{res:{sf: .4814685}}}{space 1}{space 1}{ralign 9:{res:{sf: .7210329}}}{space 1}
{space 0}{space 0}{ralign 12:PRCPCEVar1}{space 1}{c |}{space 1}{ralign 9:{res:{sf:  .092026}}}{space 1}{space 1}{ralign 9:{res:{sf: .9142628}}}{space 1}{space 1}{ralign 9:{res:{sf: 1.093869}}}{space 1}

{com}. putexcel set "${c -(}sum_table_folder{c )-}/InfExpSPFDstSum.xlsx", modify 
{res}{txt}
{com}. putexcel B2 = matrix(T), sheet("data_winsored") 
{res}{txt}file /Users/Myworld/Dropbox/ExpProject/workingfolder/tables/InfExpSPFDstSum.xlsx saved

{com}. 
. 
. ******************************
. **   Moments of Moments   ****
. ******************************
. 
. foreach mom in Mean Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.     forvalues i=0/1{c -(}
{txt}  4{com}.      egen `var'`mom'`i'p75 =pctile(`var'`mom'`i'),p(75) by(year quarter)
{txt}  5{com}.          egen `var'`mom'`i'p25 =pctile(`var'`mom'`i'),p(25) by(year quarter)
{txt}  6{com}.          egen `var'`mom'`i'p50=pctile(`var'`mom'`i'),p(50) by(year quarter)
{txt}  7{com}.          local lb: variable label `var'`mom'`i'
{txt}  8{com}.          label var `var'`mom'`i'p75 "`lb': 75 pctile"
{txt}  9{com}.          label var `var'`mom'`i'p25 "`lb': 25 pctile"
{txt} 10{com}.          label var `var'`mom'`i'p50 "`lb': 50 pctile"
{txt} 11{com}.  {c )-}
{txt} 12{com}.  {c )-}
{txt} 13{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. ******************************
. **   Labeling for plots   ****
. ******************************
. 
. 
. foreach mom in Mean {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "expected inflation from previous year"
{txt}  4{com}.         label var `var'`mom'1 "1-year-head expected inflation"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. foreach mom in Var {c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         label var `var'`mom'0 "uncertainty about inflation from previous year"
{txt}  4{com}.         label var `var'`mom'1 "uncertainty of 1-year-head expected inflation"
{txt}  5{com}.  {c )-}
{txt}  6{com}. {c )-}
{txt}
{com}. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. 
. /*
> foreach mom in Mean{c -(}
>    foreach var in PRCCPI PRCPCE{c -(}
>         local lb: variable label `var'`mom'1
>     twoway (kdensity `var'`mom'1,fcolor(none) lcolor(red)), ///
>                by(year,title("Distribution of `lb'")) 
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
>  {c )-}
> {c )-}
> */
. foreach mom in Var{c -(}
{txt}  2{com}.    foreach var in PRCCPI PRCPCE{c -(}
{txt}  3{com}.         local lb: variable label `var'`mom'1 
{txt}  4{com}.     twoway (kdensity `var'`mom'1, n(50) lcolor(blue)), ///
>                by(year,title("Distribution of `lb'")) ytitle("Fraction of population")
{txt}  5{com}.         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'1_hist", as(png) replace 
{txt}  6{com}.  {c )-}
{txt}  7{com}. {c )-}
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCCPIVar1_hist written in PNG format)
{res}{txt}(file /Users/Myworld/Dropbox/ExpProject/workingfolder/graphs/pop/hist/PRCPCEVar1_hist written in PNG format)

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. clear

. 